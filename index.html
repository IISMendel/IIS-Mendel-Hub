<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HUB MATERIE - IIS Mendel</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
:root{
  --bg1:#0f766e; 
  --bg2:#10b981; 
  --bg3:#065f46; 
  --card:#ffffff; 
  --text:#0f172a; 
  --muted:#475569;
  --accent:#0f766e; 
  --accent-2:#0ea5a4; 
  --ring: rgba(14,165,164,.25);
  --glass: rgba(255,255,255,0.08);
  --glass-border: rgba(255,255,255,0.18);
  --shadow-light: 0 8px 32px rgba(0,0,0,.08);
  --shadow-medium: 0 16px 48px rgba(0,0,0,.15);
  --shadow-heavy: 0 24px 64px rgba(0,0,0,.25);
}

*{
  box-sizing:border-box;
  margin:0;
  padding:0;
}

html,body{
  height:100%;
  overflow-x:hidden;
}

body{
  font-family:'Inter',system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif;
  color:var(--text);
  background: 
    radial-gradient(circle at 20% 80%, rgba(120,218,180,0.3) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(79,172,254,0.3) 0%, transparent 50%),
    radial-gradient(circle at 40% 40%, rgba(255,183,77,0.2) 0%, transparent 50%),
    linear-gradient(135deg, var(--bg1) 0%, var(--bg2) 35%, var(--bg3) 100%);
  background-size: 100% 100%;
  background-attachment: fixed;
  animation: gradientShift 20s ease infinite;
  position: relative;
}

@keyframes gradientShift{
  0%, 100% { filter: hue-rotate(0deg) brightness(1); }
  50% { filter: hue-rotate(10deg) brightness(1.05); }
}

/* Floating particles animation */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
  animation: float 30s linear infinite;
  pointer-events: none;
  z-index: 1;
}

@keyframes float {
  0% { transform: translateY(0px) rotate(0deg); }
  100% { transform: translateY(-100vh) rotate(360deg); }
}

.topbar{
  position:sticky; 
  top:0; 
  z-index:100; 
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  background: rgba(255,255,255,0.85);
  border-bottom:1px solid rgba(255,255,255,0.3); 
  box-shadow: var(--shadow-light);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.topbar::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
}

.topbar-inner{
  max-width:1200px;
  margin:0 auto;
  padding:1rem 1.5rem;
  display:flex;
  align-items:center;
  gap:1rem;
}

.brand{
  font-weight:800;
  font-size: 1.1rem;
  letter-spacing:-0.025em;
  background: linear-gradient(135deg, var(--accent), var(--accent-2));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.badge-small{
  margin-left:0.75rem;
  display:inline-block;
  padding:0.25rem 0.75rem;
  border-radius:50px;
  background:linear-gradient(135deg,var(--accent),var(--accent-2));
  color:#fff;
  font-weight:700;
  font-size:0.75rem;
  box-shadow: var(--shadow-light);
  animation: pulse 3s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

.container{
  max-width:1200px;
  margin:0 auto;
  padding:2rem 1.5rem;
  position: relative;
  z-index: 2;
}

.hero{
  color:#fff;
  text-align:center;
  margin:2rem 0 3rem;
  opacity: 0;
  transform: translateY(30px);
  animation: heroEnter 1s ease-out 0.2s forwards;
}

@keyframes heroEnter {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.hero h1{
  font-size: clamp(2rem, 5vw, 3.5rem);
  line-height:1.1;
  font-weight:900;
  text-shadow:0 8px 32px rgba(0,0,0,0.3);
  margin-bottom: 1rem;
  background: linear-gradient(135deg, #ffffff 0%, rgba(255,255,255,0.8) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.hero p{
  opacity:0.95;
  font-weight:500;
  font-size: 1.1rem;
  text-shadow:0 4px 16px rgba(0,0,0,0.25);
}

.grid{
  margin-top:2rem;
  display:grid;
  gap:1.5rem;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
}

@media(min-width:768px){
  .grid{
    grid-template-columns:repeat(2,1fr);
  }
}

@media(min-width:1024px){
  .grid{
    grid-template-columns:repeat(3,1fr);
  }
}

.card{
  --h:170; 
  position:relative; 
  display:flex;
  align-items:center;
  gap:1.25rem;
  background: rgba(255,255,255,0.95);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  padding:1.5rem;
  border-radius:24px;
  border:1px solid rgba(255,255,255,0.3);
  box-shadow: var(--shadow-medium);
  text-decoration:none;
  color:var(--text);
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  cursor:pointer; 
  will-change: transform;
  opacity: 0;
  transform: translateY(60px) scale(0.9);
  animation: cardEnter 0.8s ease-out calc(var(--idx) * 0.1s) forwards;
  overflow: hidden;
}

@keyframes cardEnter {
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 50%);
  opacity: 0;
  transition: opacity 0.3s ease;
  border-radius: 24px;
}

.card:focus{
  outline:3px solid var(--ring); 
  outline-offset:4px;
}

.card::after{
  content:''; 
  position:absolute; 
  inset:-2px; 
  border-radius:26px;
  background: conic-gradient(from 180deg at 50% 50%, 
    hsla(var(--h),70%,60%,0.3) 0deg,
    transparent 60deg,
    transparent 300deg, 
    hsla(var(--h),70%,60%,0.3) 360deg);
  filter:blur(20px); 
  opacity:0; 
  transition: all 0.4s ease;
  z-index: -1;
}

.card:hover{
  transform:translateY(-12px) scale(1.02) rotateX(5deg); 
  box-shadow: var(--shadow-heavy);
  border-color:rgba(255,255,255,0.5);
}

.card:hover::before {
  opacity: 1;
}

.card:hover::after{
  opacity:0.7;
}

.card:hover .emoji {
  transform: scale(1.1) rotateY(15deg);
  box-shadow: 0 20px 40px rgba(0,0,0,0.3);
}

.card .emoji{
  width:70px;
  height:70px;
  display:grid;
  place-items:center;
  font-size:2rem;
  background: linear-gradient(135deg, 
    hsla(var(--h),85%,65%,0.9) 0%, 
    hsla(var(--h),70%,50%,0.9) 100%);
  color:#fff;
  border-radius:20px;
  box-shadow: var(--shadow-medium);
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  position: relative;
  overflow: hidden;
}

.card .emoji::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.3) 50%, transparent 70%);
  transition: transform 0.6s ease;
  transform: translateX(-100%) translateY(-100%) rotate(45deg);
}

.card:hover .emoji::before {
  transform: translateX(100%) translateY(100%) rotate(45deg);
}

.title{
  font-weight:800;
  font-size:1.2rem;
  margin-bottom:0.25rem;
  line-height: 1.3;
}

.path{
  font-size:0.9rem;
  color:var(--muted);
  font-weight: 500;
} 

.extlink{
  margin-left:0.5rem;
  font-weight:700;
  text-decoration:none;
  color: var(--accent);
  transition: all 0.2s ease;
}

.extlink:hover{
  text-decoration:underline;
  color: var(--accent-2);
}

.page{
  display:none;
  opacity:0;
  transform:translateY(40px);
  transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

.page.active{
  display:block;
}

.page-header{
  position:sticky; 
  top:100px; 
  z-index:50; 
  background: rgba(255,255,255,0.95); 
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border:1px solid rgba(255,255,255,0.3); 
  border-radius:20px; 
  padding:1.5rem; 
  margin:1.5rem 0; 
  box-shadow: var(--shadow-medium);
  transition: all 0.3s ease;
}

.page-header:hover {
  box-shadow: var(--shadow-heavy);
}

.page-title{
  font-size:1.75rem;
  font-weight:900;
  color: var(--text);
  margin-bottom: 0.5rem;
}

.page-sub{
  color:var(--muted);
  margin:0.5rem 0 1rem;
  font-weight: 500;
}

.counter{
  display:inline-block;
  background:linear-gradient(135deg,var(--accent),var(--accent-2));
  color:#fff;
  font-weight:700;
  padding:0.5rem 1rem;
  border-radius:50px; 
  box-shadow: var(--shadow-light); 
  font-size:0.9rem;
  transition: all 0.3s ease;
}

.counter:hover {
  transform: scale(1.05);
  box-shadow: var(--shadow-medium);
}

.back{
  display:inline-block;
  margin-top:0.75rem;
  text-decoration:none;
  color:var(--accent);
  font-weight:700;
  padding: 0.5rem 1rem;
  border-radius: 12px;
  transition: all 0.3s ease;
  background: rgba(15, 118, 110, 0.1);
}

.back:hover {
  background: rgba(15, 118, 110, 0.2);
  transform: translateX(-4px);
}

.page-actions{
  float:right;
  display:flex;
  gap:0.75rem;
  flex-wrap:wrap;
}

.btn{
  border:none; 
  border-radius:12px; 
  padding:0.75rem 1.25rem; 
  font-weight:700; 
  cursor:pointer;
  transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  font-family: inherit;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

.btn-secondary{
  background: rgba(255,255,255,0.9);
  color:var(--accent);
  border:1px solid rgba(15, 118, 110, 0.2);
  backdrop-filter: blur(10px);
}

.btn-secondary:hover {
  background: rgba(255,255,255,1);
  transform: translateY(-2px);
  box-shadow: var(--shadow-light);
}

.btn-primary{
  background:linear-gradient(135deg,var(--accent),var(--accent-2));
  color:#fff;
  box-shadow: var(--shadow-light);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-medium);
}

.tags{
  display:flex;
  gap:0.5rem;
  flex-wrap:wrap;
  margin-top:1rem;
}

.tag{
  display:inline-flex;
  align-items:center;
  gap:0.5rem;
  padding:0.5rem 1rem;
  border-radius:50px;
  border:1px solid rgba(0,0,0,0.1);
  background:rgba(255,255,255,0.9);
  color:var(--text);
  cursor:pointer;
  font-weight:600;
  font-size:0.85rem;
  transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  backdrop-filter: blur(10px);
}

.tag:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-light);
}

.tag.active{
  background:linear-gradient(135deg,var(--accent),var(--accent-2));
  color:#fff;
  border-color:transparent;
  box-shadow: var(--shadow-light);
}

.resources-grid{
  display:grid;
  gap:1.5rem;
  margin:2rem 0;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
}

@media(min-width:768px){
  .resources-grid{
    grid-template-columns:repeat(2,1fr);
  }
}

@media(min-width:1024px){
  .resources-grid{
    grid-template-columns:repeat(3,1fr);
  }
}

.resource-card{
  background: rgba(255,255,255,0.95);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border:1px solid rgba(255,255,255,0.3);
  border-radius:20px;
  padding:1.5rem;
  box-shadow: var(--shadow-medium);
  display:flex; 
  flex-direction:column; 
  justify-content:space-between;
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  position: relative;
  overflow: hidden;
}

.resource-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(135deg, var(--accent), var(--accent-2));
  transform: scaleX(0);
  transform-origin: left;
  transition: transform 0.3s ease;
}

.resource-card:hover::before {
  transform: scaleX(1);
}

.resource-card:hover {
  transform: translateY(-8px);
  box-shadow: var(--shadow-heavy);
  border-color: rgba(255,255,255,0.5);
}

.resource-name{
  font-weight:800;
  margin-bottom:0.5rem;
  font-size: 1.1rem;
  line-height: 1.4;
}

.resource-description{
  color:var(--muted);
  font-size:0.95rem;
  margin-bottom:1.25rem; 
  flex:1;
  line-height: 1.6;
}

.resource-link{
  display:inline-flex;
  align-items:center;
  gap:0.75rem;
  background:linear-gradient(135deg,var(--accent),var(--accent-2));
  color:#fff;
  text-decoration:none;
  padding:0.75rem 1.25rem;
  border-radius:12px;
  font-weight:700;
  box-shadow: var(--shadow-light);
  transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.resource-link:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-medium);
}

.status-dot{
  display:inline-block;
  width:8px;
  height:8px;
  border-radius:50px;
  margin-left:0.75rem;
  vertical-align:middle;
  background:#d1d5db;
  transition: all 0.3s ease;
}

.status-ok{
  background:#22c55e;
  box-shadow: 0 0 10px rgba(34, 197, 94, 0.4);
} 

.status-fail{
  background:#ef4444;
  box-shadow: 0 0 10px rgba(239, 68, 68, 0.4);
} 

.status-unk{
  background:#d1d5db;
}

.side-overlay{
  position:fixed; 
  inset:0; 
  background:rgba(0,0,0,0.4); 
  backdrop-filter:blur(8px);
  -webkit-backdrop-filter:blur(8px); 
  opacity:0; 
  pointer-events:none; 
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: 200;
}

.side-overlay.open{
  opacity:1; 
  pointer-events:auto;
}

.side{
  position:fixed; 
  top:0; 
  right:0; 
  height:100vh; 
  width:min(480px,92vw); 
  background: rgba(255,255,255,0.95);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-left:1px solid rgba(255,255,255,0.3);
  transform:translateX(100%); 
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
  box-shadow: var(--shadow-heavy); 
  display:flex; 
  flex-direction:column; 
  z-index:300;
}

.side.open{
  transform:translateX(0);
}

.side-h{
  display:flex; 
  align-items:center; 
  justify-content:space-between; 
  padding:1.5rem; 
  border-bottom:1px solid rgba(0,0,0,0.1); 
  background: rgba(255,255,255,0.98);
}

.side-h strong{
  color:var(--accent);
  font-size: 1.1rem;
}

.side-s{
  padding:1rem 1.5rem; 
  border-bottom:1px solid rgba(0,0,0,0.06);
}

.side-s input{
  width:100%; 
  padding:0.75rem 1rem; 
  border:1px solid rgba(0,0,0,0.15); 
  border-radius:12px;
  font-family: inherit;
  transition: all 0.3s ease;
  background: rgba(255,255,255,0.9);
}

.side-s input:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--ring);
}

.side-b{
  padding:1rem 1.5rem; 
  border-top:1px solid rgba(0,0,0,0.06); 
  display:flex; 
  gap:0.75rem; 
  justify-content:space-between;
}

.btn-open{
  background:linear-gradient(135deg,var(--accent),var(--accent-2)); 
  color:#fff;
}

.btn-copy{
  background:rgba(15, 118, 110, 0.1); 
  color:var(--accent);
}

.side-list{
  flex:1; 
  overflow:auto; 
  padding:1rem 1.5rem;
}

.item{
  border:1px solid rgba(0,0,0,0.06); 
  border-radius:16px; 
  padding:1rem; 
  margin:0.75rem 0; 
  background: linear-gradient(135deg,rgba(14,165,164,0.08),rgba(255,255,255,0.9));
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
}

.item:hover {
  transform: translateX(4px);
  box-shadow: var(--shadow-light);
}

.item a{
  text-decoration:none; 
  color:var(--accent); 
  font-weight:700;
}

.footer{
  color:#fff;
  text-align:center;
  margin:4rem 0 2rem;
  font-weight:600;
  text-shadow:0 2px 8px rgba(0,0,0,0.25);
  opacity: 0.9;
}

.footer a{
  color:#fff;
  text-decoration:underline;
  transition: opacity 0.3s ease;
}

.footer a:hover {
  opacity: 0.8;
}

/* Loading animation */
.loading {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255,255,255,.3);
  border-radius: 50%;
  border-top-color: #fff;
  animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Responsive improvements */
@media (max-width: 768px) {
  .container {
    padding: 1rem;
  }
  
  .hero h1 {
    font-size: 2rem;
  }
  
  .grid {
    grid-template-columns: 1fr;
    gap: 1rem;
  }
  
  .card {
    padding: 1.25rem;
    gap: 1rem;
  }
  
  .card .emoji {
    width: 60px;
    height: 60px;
    font-size: 1.5rem;
  }
  
  .page-actions {
    float: none;
    margin-top: 1rem;
  }
  
  .tags {
    gap: 0.25rem;
  }
  
  .tag {
    padding: 0.4rem 0.8rem;
    font-size: 0.8rem;
  }
}

/* Smooth scrolling */
html {
  scroll-behavior: smooth;
}

/* Focus improvements for accessibility */
.card:focus-visible,
.btn:focus-visible,
.tag:focus-visible {
  outline: 3px solid var(--ring);
  outline-offset: 2px;
}
</style>
</head>
<body>
<div class="topbar">
  <div class="topbar-inner">
    <div class="brand">IIS MENDEL — Hub materie</div>
  </div>
</div>

<div class="container">
  <section class="hero">
    <h1>HUB MATERIE - IIS Mendel</h1>
    <p>Risorse didattiche innovative per il futuro dell'apprendimento</p>
  </section>
  
  <div class="page active" id="home" style="display:block;opacity:1;transform:none">
    <div class="grid" id="homeGrid"></div>
  </div>
  
  <div class="side-overlay" id="ovl"></div>
  <aside class="side" id="side" aria-hidden="true">
    <div class="side-h">
      <div>
        <strong>Elenco risorse</strong> 
        <span class="counter" id="cnt">0</span>
      </div>
      <button class="btn btn-secondary" onclick="closePanel()" aria-label="Chiudi pannello">✕</button>
    </div>
    <div class="side-s">
      <input id="srch2" type="text" placeholder="Cerca nell'elenco…" oninput="filterPanel()">
    </div>
    <div id="list" class="side-list"></div>
    <div class="side-b">
      <button class="btn btn-copy" onclick="copyLinks()">Copia elenco</button>
      <button class="btn btn-open" onclick="openAll()">Apri 5 schede</button>
    </div>
  </aside>
  
  <div class="footer">
    Pagina dell'IIS MENDEL creata dal <strong>Team Buone Pratiche</strong><br>
    Via Ferrazzi 15 — 20035 Villa Cortese (MI)<br>
    🌐 <a href="https://agrariomendel.edu.it/" target="_blank" rel="noopener">agrariomendel.edu.it</a>
  </div>
</div>

<script>
const SUBJECTS = [{"id": "agricoltura-di-precisione", "name": "Agricoltura di precisione", "emoji": "🚜"}, {"id": "ambiente-sostenibilita", "name": "Ambiente Sostenibilita", "emoji": "♻️"}, {"id": "chimica", "name": "Chimica", "emoji": "⚗️"}, {"id": "clil", "name": "Clil", "emoji": "🌍"}, {"id": "cybersecurity", "name": "Cybersecurity", "emoji": "🔒"}, {"id": "diritto", "name": "Diritto", "emoji": "⚖️"}, {"id": "educazione-civica", "name": "Educazione Civica", "emoji": "🏛️"}, {"id": "inglese", "name": "English", "emoji": "🇬🇧"}, {"id": "fisica", "name": "Fisica", "emoji": "🔭"}, {"id": "gamification", "name": "Gamification", "emoji": "🎮"}, {"id": "informatica", "name": "Informatica", "emoji": "💻"}, {"id": "italiano-storia", "name": "Italiano Storia", "emoji": "🖋️"}, {"id": "matematica", "name": "Matematica", "emoji": "➗"}, {"id": "pv-eeml", "name": "Pv Eeml", "emoji": "🔋"}, {"id": "scienze-integrate", "name": "Scienze Integrate", "emoji": "🔬"}, {"id": "stem-restanti", "name": "Stem Restanti", "emoji": "✏️"}, {"id": "valutazione", "name": "Valutazione", "emoji": "📊"}];

const SUBJECT_LINKS = {"agricoltura-di-precisione": "agricoltura-di-precisione.html", "ambiente-sostenibilita": "ambiente-sostenibilita/index.html", "chimica": "chimica/index.html", "clil": "clil/index.html", "cybersecurity": "cybersecurity/index.html", "diritto": "diritto/index.html", "educazione-civica": "educazione-civica/index.html", "inglese": "english.html", "fisica": "fisica/index.html", "gamification": "gamification/index.html", "informatica": "informatica/index.html", "italiano-storia": "italiano-storia/index.html", "matematica": "matematica/index.html", "pv-eeml": "pv_eeml/index.html", "scienze-integrate": "scienze-integrate/index.html", "stem-restanti": "stem-restanti/index.html", "valutazione": "valutazione/index.html"};

const HUB_DATA = {"agricoltura-di-precisione": [{"title": "Sentinel Hub", "desc": "Immagini satellitari e NDVI.", "url": "https://www.sentinel-hub.com/", "tags": ["Satellite"]}, {"title": "DroneDeploy", "desc": "Piattaforma cloud leader per mapping aereo agricolo: mappe NDVI, conteggio piante, analisi stress idrico.", "url": "https://www.dronedeploy.com/", "tags": ["Precision Farming", "Import"]}, {"title": "Pix4D Agriculture", "desc": "Software fotogrammetrico per agricoltura di precisione: elaborazione immagini drone.", "url": "https://www.pix4d.com/product/pix4dfields", "tags": ["Precision Farming", "Import"]}], "ambiente-sostenibilita": [], "chimica": [{"title": "PhET — Simulazioni di chimica", "desc": "Interattivi su atomi, legami, soluzioni.", "url": "https://phet.colorado.edu/it/simulations/category/chemistry", "tags": ["Simulazioni"]}], "clil": [], "cybersecurity": [], "diritto": [], "educazione-civica": [], "inglese": [{"title": "BBC Learning English", "desc": "Lezioni audio/video.", "url": "https://www.bbc.co.uk/learningenglish", "tags": ["Video"]}, {"title": "British Council — LearnEnglish", "desc": "Esercizi graduati.", "url": "https://learnenglish.britishcouncil.org/", "tags": ["Grammar"]}], "fisica": [], "gamification": [], "informatica": [], "italiano-storia": [{"title": "anki.com", "desc": "Risorsa importata.", "url": "https://anki.com", "tags": ["Import"]}], "matematica": [{"title": "GeoGebra", "desc": "Strumenti dinamici.", "url": "https://www.geogebra.org/", "tags": ["Strumenti"]}], "pv-eeml": [], "scienze-integrate": [], "stem-restanti": [], "valutazione": []};

// Assign colors to cards based on index
const colors = [
  170, 200, 230, 260, 290, 320, 350, 20, 50, 80, 110, 140, 170, 200, 230, 260, 290
];

// BUILD HOME
function buildHome(){
  const grid = document.getElementById('homeGrid');
  grid.innerHTML = '';
  SUBJECTS.sort((a,b)=>a.name.localeCompare(b,'it')).forEach((s, idx) => {
    const ext = SUBJECT_LINKS[s.id] || null;
    const card = document.createElement('div');
    card.className = 'card'; 
    card.setAttribute('tabindex','0'); 
    card.style.setProperty('--idx', idx);
    card.style.setProperty('--h', colors[idx % colors.length]);
    
    card.onclick = () => showPage(s.id);
    card.onkeydown = (e)=>{ 
      if(e.key==='Enter' || e.key===' '){ 
        e.preventDefault(); 
        showPage(s.id);
      } 
    };
    
    card.innerHTML = `
      <div class="emoji">${s.emoji||"📘"}</div>
      <div>
        <div class="title">${s.name}</div>
        <div class="path">${s.id}${ext ? ` <a class="extlink" href="${ext}" target="_blank" rel="noopener" onclick="event.stopPropagation()" aria-label="Apri pagina esterna">↗</a>` : ''}</div>
      </div>`;
    grid.appendChild(card);
  });
}

// SUBJECT PAGES
function ensurePage(id){
  if(document.getElementById(id)) return;
  const s = SUBJECTS.find(x=>x.id===id) || {name:id, emoji:"📘"};
  const ext = SUBJECT_LINKS[id] || null;
  const page = document.createElement('div');
  page.className = 'page'; 
  page.id = id;
  
  page.innerHTML = `
    <div class="page-header">
      <div class="page-title">${s.name}</div>
      <div class="page-sub">Selezione di risorse (curate + import)</div>
      <a href="#" class="back" onclick="showPage('home')">← Torna alla Home</a>
      <span class="counter" id="${id}Counter">0</span>
      <div class="page-actions">
        ${ext ? `<a class="btn btn-primary" href="${ext}" target="_blank" rel="noopener">↗ Pagina esterna</a>` : ''}
        <button class="btn btn-secondary" onclick="openPanelFromCurrent()">🔍 Elenco</button>
        <button class="btn btn-secondary" onclick="verifyLinks()">✔️ Verifica link</button>
      </div>
      <div class="tags" id="${id}Tags"></div>
    </div>
    <section class="resources-grid" id="${id}Resources"></section>`;
  document.querySelector('.container').appendChild(page);
}

function uniqueTags(list){
  const set = new Set();
  list.forEach(x => (x.tags||[]).forEach(t=>set.add(t)));
  return Array.from(set).sort((a,b)=>a.localeCompare(b,'it'));
}

function buildTags(pageId, list){
  const wrap = document.getElementById(pageId+'Tags'); 
  if(!wrap) return;
  wrap.innerHTML = '';
  const tags = uniqueTags(list);
  
  tags.forEach((t, idx) => {
    const span = document.createElement('button');
    span.className = 'tag'; 
    span.textContent = t;
    span.style.animationDelay = `${idx * 0.05}s`;
    span.onclick = () => { 
      span.classList.toggle('active'); 
      applyFilters(pageId); 
    };
    wrap.appendChild(span);
  });
}

function applyFilters(pageId){
  const grid = document.getElementById(pageId+'Resources');
  const active = Array.from(document.querySelectorAll('#'+pageId+'Tags .tag.active')).map(el=>el.textContent);
  const cards = Array.from(grid.children);
  
  cards.forEach(card => {
    const tags = (card.getAttribute('data-tags')||'').split(/\s+/).filter(Boolean);
    const show = active.length===0 || active.every(t => tags.includes(t));
    card.style.display = show ? '' : 'none';
  });
  
  const visible = cards.filter(c => c.style.display !== 'none').length;
  const counter = document.getElementById(pageId+'Counter'); 
  if(counter) counter.textContent = visible + ' risorse';
}

function createResourceCards(containerId, list){
  const grid = document.getElementById(containerId); 
  if(!grid) return; 
  grid.innerHTML = '';
  
  list.forEach((item, idx) => {
    const el = document.createElement('div'); 
    el.className = 'resource-card';
    el.style.animationDelay = `${idx * 0.1}s`;
    const tagStr = (item.tags||[]).join(' ');
    el.setAttribute('data-tags', tagStr);
    
    el.innerHTML = `
      <div class="resource-name">${item.title}</div>
      <div class="resource-description">${item.desc||''}</div>
      <a class="resource-link" href="${item.url}" target="_blank" rel="noopener">Apri risorsa →</a>
      <span class="status-dot status-unk" title="Stato link"></span>`;
    grid.appendChild(el);
  });
}

// Side panel functionality
const ovl = document.getElementById('ovl'); 
const side = document.getElementById('side');
const listEl = document.getElementById('list'); 
const cnt = document.getElementById('cnt'); 
const srch2 = document.getElementById('srch2');

function openPanel(){ 
  ovl.classList.add('open'); 
  side.classList.add('open'); 
}

function closePanel(){ 
  ovl.classList.remove('open'); 
  side.classList.remove('open'); 
}

ovl.addEventListener('click', closePanel);

function buildPanelFrom(pageId){
  const links = Array.from(document.querySelectorAll('#'+pageId+'Resources a.resource-link'));
  listEl.innerHTML = '';
  
  links.forEach((a, idx) => {
    const it = document.createElement('div'); 
    it.className = 'item';
    it.style.animationDelay = `${idx * 0.05}s`;
    const name = a.closest('.resource-card').querySelector('.resource-name').textContent;
    it.innerHTML = `
      <a href="${a.href}" target="_blank" rel="noopener">${name}</a>
      <p style="margin:.25rem 0 0; font-size:.85rem; color:#555;">${a.href}</p>`;
    listEl.appendChild(it);
  });
  cnt.textContent = links.length;
}

function openPanelFromCurrent(){
  const currentPage = document.querySelector('.page.active'); 
  if(!currentPage) return;
  buildPanelFrom(currentPage.id); 
  openPanel();
}

function filterPanel(){
  const q = (srch2.value||'').toLowerCase();
  Array.from(listEl.children).forEach(div=>{ 
    const t = (div.innerText||'').toLowerCase(); 
    div.style.display = t.includes(q) ? '' : 'none'; 
  });
}

function openAll(){
  const currentPage = document.querySelector('.page.active'); 
  if(!currentPage) return;
  const links = Array.from(document.querySelectorAll('#'+currentPage.id+'Resources a.resource-link')).slice(0,5);
  links.forEach(a=>window.open(a.href,'_blank','noopener'));
}

function copyLinks(){
  const currentPage = document.querySelector('.page.active'); 
  if(!currentPage) return;
  const lines = Array.from(document.querySelectorAll('#'+currentPage.id+'Resources .resource-card'))
    .map(card => card.querySelector('.resource-name').textContent + ' — ' + card.querySelector('a').href);
  navigator.clipboard.writeText(lines.join('\n')).then(()=>alert('Elenco copiato negli appunti.'));
}

// Enhanced link verifier with visual feedback
async function verifyLinks(){
  const currentPage = document.querySelector('.page.active');
  if(!currentPage) return;
  
  const cards = Array.from(currentPage.querySelectorAll('.resource-card'));
  const button = currentPage.querySelector('button[onclick="verifyLinks()"]');
  const originalText = button.textContent;
  
  button.innerHTML = '<span class="loading"></span> Verificando...';
  button.disabled = true;
  
  for(const card of cards){
    const url = card.querySelector('a').href;
    const dot = card.querySelector('.status-dot');
    dot.className = 'status-dot status-unk';
    
    try{
      await fetch(url, {mode:'no-cors', cache:'no-store'});
      dot.className = 'status-dot status-ok';
      await new Promise(resolve => setTimeout(resolve, 100)); // Small delay for visual effect
    }catch(err){
      dot.className = 'status-dot status-fail';
    }
  }
  
  button.textContent = originalText;
  button.disabled = false;
  alert('Verifica completata! I pallini verdi indicano link raggiungibili.');
}

// Enhanced navigation with smooth transitions
function showPage(pageId){
  document.querySelectorAll('.page').forEach(p => { 
    p.classList.remove('active'); 
    p.style.opacity=0; 
    p.style.transform='translateY(40px)'; 
  });
  
  ensurePage(pageId);
  const data = HUB_DATA[pageId] || [];
  buildTags(pageId, data);
  createResourceCards(pageId+'Resources', data);
  applyFilters(pageId);
  
  setTimeout(()=>{ 
    const el = document.getElementById(pageId); 
    el.classList.add('active');
    setTimeout(()=>{ 
      el.style.opacity=1; 
      el.style.transform='translateY(0)' 
    }, 50); 
  }, 150);
  
  window.scrollTo({top:0, behavior:'smooth'});
}

// Initialize on load
window.addEventListener('DOMContentLoaded', function(){ 
  buildHome(); 
  
  // Add some startup animations
  setTimeout(() => {
    document.body.style.overflow = 'visible';
  }, 500);
});

// Add smooth scrolling for better UX
document.addEventListener('click', function(e) {
  if (e.target.classList.contains('back')) {
    e.preventDefault();
    showPage('home');
  }
});

// Enhanced keyboard navigation
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    const openPanel = document.querySelector('.side.open');
    if (openPanel) {
      closePanel();
    }
  }
});
</script>
</body>
</html>
